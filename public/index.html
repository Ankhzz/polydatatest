<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Autenticación y Métricas de Polygon</title>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.6.1/dist/web3.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>Autenticación con Wallet</h1>
        <button id="connectWalletBtn" class="btn-green">Conectar Wallet</button>
        <p id="walletAddress"></p>

        <h2>Métricas de Polygon</h2>
        <button id="getMetricsBtn" class="btn-green" disabled>Obtener Métricas</button>

        <div id="metrics" class="metrics-container">
            <p><strong>Dirección:</strong> <span id="metricsAddress"></span></p>
            <p><strong>Transacciones Totales:</strong> <span id="totalTransactions"></span></p>
            <p><strong>POL gastados:</strong> <span id="polSpent"></span></p>
            <p><strong>USD gastados:</strong> <span id="usdSpent"></span></p>          
            <p><strong>POL transferidos:</strong> <span id="polTransferred"></span></p>
            <p><strong>POL recibido:</strong> <span id="polreceived"></span></p>
            <p><strong>USD transferidos:</strong> <span id="usdTransferred"></span></p>
        </div>
    </div>

    <script>
        let userAddress = null;

        // Conectar la wallet
        document.getElementById('connectWalletBtn').addEventListener('click', async () => {
            if (window.ethereum) {
                const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
                userAddress = accounts[0];
                document.getElementById('walletAddress').textContent = `Conectado con: ${userAddress}`;
                document.getElementById('getMetricsBtn').disabled = false;
            } else {
                alert('Por favor, instala MetaMask.');
            }
        });

        // Obtener métricas de Polygon
        document.getElementById('getMetricsBtn').addEventListener('click', async () => {
            if (!userAddress) {
                alert('Primero debes conectar tu wallet.');
                return;
            }

            try {
                const response = await fetch(`http://localhost:3000/metrics/polygon/${userAddress}`);
                const data = await response.json();
                if (data.error) {
                    alert(data.error);
                } else {
                    document.getElementById('metricsAddress').textContent = data.address;
                    document.getElementById('totalTransactions').textContent = data.totalTransactions;
                    document.getElementById('polSpent').textContent = data.totalGasSpent;
                    document.getElementById('usdSpent').textContent = data.usdSpent;                   
                    document.getElementById('polTransferred').textContent = data.totalTransferred;
                    document.getElementById('polreceived').textContent = data.totalReceived;
                    document.getElementById('usdTransferred').textContent = data.usdTransferred;
                }
            } catch (error) {
                console.error('Error al obtener métricas:', error);
                alert('Error al obtener métricas');
            }
        });
    </script>
</body>
</html>
